# 声音和编码

## 我们的听力

人能听到多少声音呢？这是个很简单又很复杂的问题。简单的来说从声强和频率上来说，人可以听见频率在20Hz到20000Hz之间的声音（儿童青少年以及一些天生听觉敏锐的人可以听到的最高频率比这个要高一些），同样人可以听见的最小声强是0dB，最大的不引起鼓膜损伤的大约在130dB左右。下图中的听阈就是引起人听觉的下限，痛阈就是使人难以忍受的上限。当然人的一生中这个图的大小会变化，一般随着年龄的增大，可以听到的声音越来越少。
![](/images/lab04/Heorflaeche.png "唱歌的范围比说话多不少")

这从某种意义上决定了音频的编码是需要有所舍弃有所保留的，显然超出人听力范围的声音信号在必要的时候是可以舍弃的。

## 计算机的听力

计算机没有类似我们的听觉，它想要听见声音就要把声音转化为它可以识别的电信号。当然这就衍生出了数字信号与模拟信号的概念。简单来说模拟信号尽最大努力去模拟还原原始信号，虽然理论上可以完全还原原始的声音信号，但在实际应用中受制于各种各样的噪声和不可避免的传输衰减，模拟信号的还原程度总是不尽如人意的。
数字信号的思路显然与此不同，它将信号进行重新的编码，将连续的信号化为离散的数值，这样传输过程中的噪声的影响就相对而言减少了，因为在计算机看来，一切都是0和1，这两者之间的区别显然要比模拟信号中高和低的差别大得多。
那么问题来了，计算机既然要将这些原始信号转化为数字信号，那是不是转化的频率就跟原始信号的频率一样呢？
采样定律告诉我们，显然不是这样的，为了保证转化过程即采样过程中信号的不失真，转化频率即采样频率至少要是原始信号频率的两倍以上。
这也就意味着，我们听见的20000HZ的声音，计算机要以40000Hz的频率去“听”才可以听得清楚。

## 原始：WAV格式

给音频信号编码最简单的想法显然是什么都把忠实的编码下来。WAV格式就是这样一种编码格式，它所存储的是不加压缩的通过PCM方式获得的数字信号。至于PCM方式，形象地说就是首先将总的声音强度的区间划分为很多个子区间，采样时再把每一个时刻的声音强度转化为其所在区间对应的一个数值，这样只要采样的频率足够高，区间划分的足够细，就可以保证最大限度地还原原始的声音信号。
PCM方法足够简单，同样WAV格式对信号的处理也十分简单，以至于这样存储下来的信号是最接近于原始信号的，同时也是体积最大的。这也就WAV成了很多音频发烧友的优先选择。
WAV格式实际上可以储存任何具有波形的信号而不光只是声音，所以类似matlab的可以产生波形信号的软件都会用上WAV格式。

## 无损压缩：FLAC格式&APE格式

WAV格式虽然音质很好，但是大多数时候太占空间，人们会想有没有一种无损的压缩方式来对这些PCM数据压缩来节约空间。当然这样的解决方案是有的，分别就是FLAC格式和APE格式。
FLAC格式最大的特征就是自由，这意味着使用这样一个格式是没有所谓的专利限制，同样编码这个格式的软件也是如此。这使得对FLAC格式的支持迅速的普及开来。其次为了保证对PCM数据的无损压缩，FLAC格式使用了定点取样的方法避免了浮点取样带来的四舍五入的误差；之后为了保证数据传输中不出现损失，FLAC格式还保存了大量原始数据的校验码用以校对。最后FLAC格式本身还提供了不同的压缩档次使得使用者可以在压缩率和压缩速度上进行自由选择。当然得益于FLAC格式的开源特性和简单的解码运算，许许多多的软件乃至硬件都提供了对其的支持。
APE格式相较于FLAC格式，虽然它的编码器也是开源的，但是并非完全的自由软件，使用起来依旧受到一定的限制，同时它的解码也相较FLAC格式略为复杂，还缺少一定的校验和处理编码错误的功能，使得这个格式的普及度要小于FLAC格式。当然二者的压缩率是不分高下的。

## 有损压缩：MP3格式&AAC格式

虽然说FLAC和APE格式可以实现对原始的PCM信号50%左右的压缩率，但是有的时候这样都太占空间，人们又开始思考，能不能在保证听觉感受的情况下舍弃一部分数据实现有损压缩呢？
我们熟悉的MP3格式就是这样一种有损的压缩格式。通过很多的方法包括心理学模型舍弃掉PCM数据中对人类听觉不重要的一部分实现对其的压缩。
不得不说MP3格式的诞生遇上了互联网的巨大发展，反过来极大地推动了互联网音乐的发展。令人庆幸的是这个格式的专利已于去年过期，很多有关的限制已经宣告解除。
AAC格式也是基于这样一个想法的后起之秀，相比于MP3格式，它的压缩率相对较高，大多数情况下音质也相对较好，还具有很多MP3格式不具备的功能。得益于大量公司参与了其标准的制定，AAC格式的普及程度也相对较广，苹果公司旗下的iTunes中的音乐使用的音乐就是AAC格式。

## 如何选择
除去这些使用比较广泛的格式，还有许许多多的格式没有进行详细的介绍，但是基本上都可以简单的划分成无损和有损两个阵营。显然每一种格式都有自己的长短处，但更多的时候选择什么样的格式，一定是要取决于我们的需要。